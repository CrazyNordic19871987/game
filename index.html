<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–õ–û–†–ò–Ø: –•—Ä–∞–Ω–∏—Ç–µ–ª—å –≥–æ—Ä–æ–¥–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --deep-blue: #0B1A33;
            --mint: #00C48C;
            --gold: #FFB800;
            --white: #FFFFFF;
            --red: #FF6B6B;
            --purple: #A855F7;
        }

        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap');

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--deep-blue);
            color: var(--white);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Start Screen */
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--deep-blue);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: transform 0.8s ease;
        }

        #startScreen.hidden {
            transform: translateY(-100%);
        }

        .game-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--mint), var(--gold), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            text-shadow: 0 0 50px rgba(0, 196, 140, 0.5);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .game-subtitle {
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 40px;
        }

        .start-btn {
            padding: 20px 60px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--mint), #00A878);
            border: none;
            border-radius: 50px;
            color: var(--deep-blue);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 196, 140, 0.4);
        }

        .start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 20px 50px rgba(0, 196, 140, 0.6);
        }

        /* Game Container */
        #gameContainer {
            position: relative;
            width: 900px;
            height: 600px;
            border: 3px solid var(--mint);
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(180deg, #0a0f1a 0%, var(--deep-blue) 100%);
            box-shadow: 0 0 50px rgba(0, 196, 140, 0.3);
        }

        /* Canvas */
        #gameCanvas {
            display: block;
        }

        /* UI Overlay */
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .hud {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hud-item {
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid var(--mint);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
        }

        .hud-item span {
            color: var(--gold);
        }

        /* Mission Panel */
        #missionPanel {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 30px;
            border-radius: 15px;
            border: 2px solid var(--gold);
            max-width: 80%;
            text-align: center;
        }

        #missionPanel h3 {
            color: var(--gold);
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 5px;
        }

        #missionPanel p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        /* Oracle Dialog */
        #oracleDialog {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(168, 85, 247, 0.2);
            border: 2px solid var(--purple);
            border-radius: 20px;
            padding: 20px 30px;
            max-width: 70%;
            text-align: center;
            display: none;
        }

        #oracleDialog.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        #oracleDialog .oracle-avatar {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        #oracleDialog p {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .controls kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 3px;
        }

        /* Department Selection */
        #departmentSelect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 26, 51, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        #departmentSelect.hidden {
            display: none;
        }

        #departmentSelect h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: var(--mint);
            margin-bottom: 30px;
        }

        .dept-options {
            display: flex;
            gap: 20px;
        }

        .dept-btn {
            width: 180px;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .dept-btn:hover {
            transform: translateY(-10px);
            border-color: var(--mint);
            box-shadow: 0 15px 30px rgba(0, 196, 140, 0.3);
        }

        .dept-btn .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .dept-btn .name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--white);
        }

        /* Victory Screen */
        #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 26, 51, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 60;
        }

        #victoryScreen.hidden {
            display: none;
        }

        #victoryScreen h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 20px;
            animation: victoryPulse 1s ease-in-out infinite;
        }

        @keyframes victoryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        #victoryScreen .role {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        #victoryScreen p {
            font-size: 1.2rem;
            max-width: 500px;
            text-align: center;
            margin-bottom: 30px;
            color: rgba(255, 255, 255, 0.8);
        }

        #victoryScreen .restart-btn {
            padding: 15px 40px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            background: var(--mint);
            border: none;
            border-radius: 30px;
            color: var(--deep-blue);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #victoryScreen .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 196, 140, 0.4);
        }

        .victory-buttons {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .victory-buttons .camp-btn {
            padding: 15px 35px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--gold), #ff9500);
            border: none;
            border-radius: 30px;
            color: var(--deep-blue);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .victory-buttons .camp-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 184, 0, 0.4);
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen">
        <h1 class="game-title">–ì–õ–û–†–ò–Ø</h1>
        <p class="game-subtitle">–•—Ä–∞–Ω–∏—Ç–µ–ª—å –≥–æ—Ä–æ–¥–∞</p>
        <button class="start-btn" onclick="startGame()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
        <canvas id="gameCanvas" width="900" height="600"></canvas>
        
        <!-- UI -->
        <div id="ui">
            <div class="hud">
                <div class="hud-item">HP: <span id="hpDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
                <div class="hud-item">XP: <span id="xpDisplay">0</span></div>
                <div class="hud-item">–£—Ä–æ–≤–µ–Ω—å: <span id="levelDisplay">1</span></div>
            </div>
            
            <div id="oracleDialog">
                <div class="oracle-avatar">üëÅÔ∏è</div>
                <p id="oracleText">–ü—Ä–∏–≤–µ—Ç, –•—Ä–∞–Ω–∏—Ç–µ–ª—å!</p>
            </div>
            
            <div id="missionPanel">
                <h3>üìç –ú–∏—Å—Å–∏—è</h3>
                <p id="missionText">–ù–∞–π–¥–∏ –û—Ä–∞–∫—É–ª–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞</p>
            </div>
        </div>

        <!-- Department Selection -->
        <div id="departmentSelect" class="hidden">
            <h2>–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—É—Ç—å</h2>
            <div class="dept-options">
                <div class="dept-btn" onclick="chooseDepartment('engineer')">
                    <div class="icon">üèóÔ∏è</div>
                    <div class="name">–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π</div>
                </div>
                <div class="dept-btn" onclick="chooseDepartment('digital')">
                    <div class="icon">üíª</div>
                    <div class="name">–¶–∏—Ñ—Ä–æ–≤–æ–π</div>
                </div>
                <div class="dept-btn" onclick="chooseDepartment('eco')">
                    <div class="icon">üå±</div>
                    <div class="name">–≠–∫–æ-–ª–∞–±</div>
                </div>
                <div class="dept-btn" onclick="chooseDepartment('media')">
                    <div class="icon">üì∏</div>
                    <div class="name">–ù–æ–≤–æ—Å—Ç–∏</div>
                </div>
            </div>
        </div>

        <!-- Victory Screen -->
        <div id="victoryScreen" class="hidden">
            <h1>–ü–û–ë–ï–î–ê!</h1>
            <div class="role" id="finalRole">üèÜ</div>
            <p id="finalText">–¢—ã —Å–ø–∞—Å –≥–æ—Ä–æ–¥ –ì–ª–æ—Ä–∏—è!</p>
            <div class="victory-buttons">
                <button class="restart-btn" onclick="restartGame()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
                <a href="#form" class="camp-btn" onclick="openCampForm()">–ó–ê–ü–ò–°–ê–¢–¨–°–Ø –í –õ–ê–ì–ï–†–¨</a>
            </div>
        </div>
    </div>

    <div class="controls">
        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> –∏–ª–∏ <kbd>‚Üë</kbd><kbd>‚Üì</kbd><kbd>‚Üê</kbd><kbd>‚Üí</kbd> | <kbd>–ü—Ä–æ–±–µ–ª</kbd> - –¥–µ–π—Å—Ç–≤–∏–µ
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game State
        let game = {
            started: false,
            phase: 'explore', // explore, mission, victory
            department: null,
            hp: 3,
            xp: 0,
            level: 1,
            mission: 0,
            player: { x: 450, y: 500, size: 30, speed: 5 },
            keys: {},
            npcs: [],
            collectibles: [],
            particles: []
        };

        // Game Objects
        const buildings = [
            { x: 100, y: 80, w: 150, h: 100, color: '#1a3a5c', name: '–®—Ç–∞–±' },
            { x: 650, y: 80, w: 150, h: 100, color: '#1a3a5c', name: '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è' },
            { x: 100, y: 350, w: 120, h: 80, color: '#2d4a3e', name: '–≠–∫–æ-–∑–æ–Ω–∞' },
            { x: 680, y: 350, w: 120, h: 80, color: '#3d2d4a', name: '–ú–µ–¥–∏–∞-—Ü–µ–Ω—Ç—Ä' },
            { x: 350, y: 200, w: 200, h: 150, color: '#4a3a1a', name: '–û–†–ê–ö–£–õ', isOracle: true }
        ];

        const npcTypes = {
            engineer: { emoji: 'üë∑', mission: '–ü–æ—á–∏–Ω–∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—é', xp: 50 },
            digital: { emoji: 'üë®‚Äçüíª', mission: '–ù–∞–π–¥–∏ –≤–∏—Ä—É—Å', xp: 50 },
            eco: { emoji: 'üßë‚Äçüî¨', mission: '–°–æ–±–µ—Ä–∏ –ø—Ä–æ–±—ã', xp: 50 },
            media: { emoji: 'üì∏', mission: '–°–¥–µ–ª–∞–π —Ä–µ–ø–æ—Ä—Ç–∞–∂', xp: 50 }
        };

        // Initialize NPCs
        function initNPCs() {
            game.npcs = [
                { x: 175, y: 150, type: 'engineer', completed: false },
                { x: 725, y: 150, type: 'digital', completed: false },
                { x: 160, y: 400, type: 'eco', completed: false },
                { x: 740, y: 400, type: 'media', completed: false },
                { x: 450, y: 300, type: 'oracle', completed: false }
            ];
        }

        // Input Handling
        document.addEventListener('keydown', (e) => {
            game.keys[e.key.toLowerCase()] = true;
            if (e.key === ' ' || e.key === 'Enter') interact();
        });
        document.addEventListener('keyup', (e) => game.keys[e.key.toLowerCase()] = false);

        // Start Game
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            game.started = true;
            initNPCs();
            showOracle('–•—Ä–∞–Ω–∏—Ç–µ–ª—å! –ì–æ—Ä–æ–¥ –ì–ª–æ—Ä–∏—è –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ù–∞–π–¥–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π 4—Ö –æ—Ç–¥–µ–ª–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω–∏ –∏—Ö –∑–∞–¥–∞–Ω–∏—è. –ü–æ—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∫–æ –º–Ω–µ!');
            gameLoop();
        }

        // Show Oracle Dialog
        function showOracle(text) {
            const dialog = document.getElementById('oracleDialog');
            document.getElementById('oracleText').textContent = text;
            dialog.classList.add('show');
            setTimeout(() => dialog.classList.remove('show'), 4000);
        }

        // Choose Department
        function chooseDepartment(dept) {
            game.department = dept;
            document.getElementById('departmentSelect').classList.add('hidden');
            showOracle('–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –Ω–∞–π–¥–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π –≤—Å–µ—Ö –æ—Ç–¥–µ–ª–æ–≤ –∏ –ø–æ–º–æ–≥–∏ –∏–º. –ù–∞—á–Ω–∏ —Å —Ç–æ–≥–æ, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±–µ –±–ª–∏–∂–µ!');
            updateMission();
        }

        // Update Mission
        function updateMission() {
            const missions = [
                '–ù–∞–π–¥–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π 4x –æ—Ç–¥–µ–ª–æ–≤',
                '–í—ã–ø–æ–ª–Ω–∏ –º–∏—Å—Å–∏–∏ –æ—Ç–¥–µ–ª–æ–≤',
                '–í–µ—Ä–Ω–∏—Å—å –∫ –û—Ä–∞–∫—É–ª—É'
            ];
            document.getElementById('missionText').textContent = missions[game.mission];
        }

        // Interact with NPC
        function interact() {
            const player = game.player;
            
            game.npcs.forEach(npc => {
                const dist = Math.hypot(player.x - npc.x, player.y - npc.y);
                if (dist < 60 && !npc.completed) {
                    if (npc.type === 'oracle') {
                        // Final victory
                        if (game.xp >= 200) {
                            showVictory();
                        } else {
                            showOracle('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏ –≤—Å–µ –º–∏—Å—Å–∏–∏ –æ—Ç–¥–µ–ª–æ–≤! –¢–µ–±–µ –Ω—É–∂–Ω–æ ' + (200 - game.xp) + ' XP.');
                        }
                    } else if (game.department) {
                        // Complete mission
                        if (npc.type === game.department || true) {
                            npc.completed = true;
                            const xpGain = npcTypes[npc.type].xp;
                            game.xp += xpGain;
                            game.level = Math.floor(game.xp / 50) + 1;
                            createParticles(npc.x, npc.y, '#FFD700');
                            showOracle('–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! +' + xpGain + ' XP');
                            updateDisplay();
                            
                            // Check if all missions done
                            const allDone = game.npcs.filter(n => n.type !== 'oracle').every(n => n.completed);
                            if (allDone) {
                                game.mission = 2;
                                updateMission();
                            }
                        }
                    } else {
                        showOracle('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Å–≤–æ—ë –æ—Ç–¥–µ–ª–µ–Ω–∏–µ!');
                        document.getElementById('departmentSelect').classList.remove('hidden');
                    }
                }
            });

            // Collect collectibles
            game.collectibles = game.collectibles.filter(c => {
                const dist = Math.hypot(player.x - c.x, player.y - c.y);
                if (dist < 30) {
                    game.xp += 10;
                    createParticles(c.x, c.y, '#00C48C');
                    updateDisplay();
                    return false;
                }
                return true;
            });
        }

        // Victory
        function showVictory() {
            game.phase = 'victory';
            const screen = document.getElementById('victoryScreen');
            screen.classList.remove('hidden');
            
            const roles = {
                engineer: { icon: 'üõ†Ô∏è', text: '–¢—ã —Å—Ç–∞–ª –ú–ê–°–¢–ï–†–û–ú-–°–ë–û–†–©–ò–ö–û–ú! –í–æ–ø–ª–æ—â–∞–µ—à—å –∏–¥–µ–∏ –≤ –∂–∏–∑–Ω—å! –ü—Ä–∏—Ö–æ–¥–∏ –ª–µ—Ç–æ–º –≤ –ª–∞–≥–µ—Ä—å –ì–õ–û–†–ò–Ø!' },
                digital: { icon: 'üíª', text: '–¢—ã —Å—Ç–∞–ª –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–ú! –ü–∏—à–µ—à—å –∫–æ–¥ –¥–ª—è –≥–æ—Ä–æ–¥–∞! –ü—Ä–∏—Ö–æ–¥–∏ –ª–µ—Ç–æ–º –≤ –ª–∞–≥–µ—Ä—å –ì–õ–û–†–ò–Ø!' },
                eco: { icon: 'üî¨', text: '–¢—ã —Å—Ç–∞–ª –õ–ê–ë–û–†–ê–ù–¢–û–ú! –ü—Ä–æ–≤–æ–¥–∏—à—å –≤–∞–∂–Ω—ã–µ –æ–ø—ã—Ç—ã! –ü—Ä–∏—Ö–æ–¥–∏ –ª–µ—Ç–æ–º –≤ –ª–∞–≥–µ—Ä—å –ì–õ–û–†–ò–Ø!' },
                media: { icon: 'üì∏', text: '–¢—ã —Å—Ç–∞–ª –†–ï–ü–û–†–¢–Å–†–û–ú! –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å –∏—Å—Ç–æ—Ä–∏–∏ –≥–æ—Ä–æ–¥–∞! –ü—Ä–∏—Ö–æ–¥–∏ –ª–µ—Ç–æ–º –≤ –ª–∞–≥–µ—Ä—å –ì–õ–û–†–ò–Ø!' }
            };
            
            const role = roles[game.department] || roles.engineer;
            document.getElementById('finalRole').textContent = role.icon;
            document.getElementById('finalText').textContent = role.text;
        }

        // Open Camp Form
        function openCampForm() {
            alert('–î–ª—è –∑–∞–ø–∏—Å–∏ –≤ –ª–∞–≥–µ—Ä—å –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: https://gloria-camp.ru');
        }

        // Restart
        function restartGame() {
            location.reload();
        }

        // Create Particles
        function createParticles(x, y, color) {
            for (let i = 0; i < 10; i++) {
                game.particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 5,
                    vy: (Math.random() - 0.5) * 5,
                    life: 30,
                    color
                });
            }
        }

        // Update Display
        function updateDisplay() {
            document.getElementById('hpDisplay').textContent = '‚ù§Ô∏è'.repeat(game.hp);
            document.getElementById('xpDisplay').textContent = game.xp;
            document.getElementById('levelDisplay').textContent = game.level;
        }

        // Game Loop
        function gameLoop() {
            if (!game.started) return;
            
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // Update
        function update() {
            if (game.phase === 'victory') return;

            const player = game.player;
            const speed = player.speed;

            if (game.keys['w'] || game.keys['arrowup']) player.y -= speed;
            if (game.keys['s'] || game.keys['arrowdown']) player.y += speed;
            if (game.keys['a'] || game.keys['arrowleft']) player.x -= speed;
            if (game.keys['d'] || game.keys['arrowright']) player.x += speed;

            // Bounds
            player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
            player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));

            // Spawn collectibles
            if (Math.random() < 0.02 && game.collectibles.length < 5) {
                game.collectibles.push({
                    x: 100 + Math.random() * 700,
                    y: 100 + Math.random() * 400,
                    type: 'xp'
                });
            }

            // Update particles
            game.particles = game.particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                return p.life > 0;
            });
        }

        // Render
        function render() {
            // Clear
            ctx.fillStyle = '#0B1A33';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Grid
            ctx.strokeStyle = 'rgba(0, 196, 140, 0.1)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
            }

            // Buildings
            buildings.forEach(b => {
                ctx.fillStyle = b.color;
                ctx.fillRect(b.x, b.y, b.w, b.h);
                ctx.strokeStyle = b.isOracle ? '#A855F7' : '#00C48C';
                ctx.lineWidth = b.isOracle ? 3 : 2;
                ctx.strokeRect(b.x, b.y, b.w, b.h);
                
                ctx.fillStyle = '#fff';
                ctx.font = '12px Orbitron';
                ctx.textAlign = 'center';
                ctx.fillText(b.name, b.x + b.w/2, b.y - 10);
            });

            // NPCs
            game.npcs.forEach(npc => {
                ctx.font = '35px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Glow if completed
                if (npc.completed) {
                    ctx.shadowColor = '#00C48C';
                    ctx.shadowBlur = 20;
                }
                ctx.fillText(npcTypes[npc.type]?.emoji || 'üëÅÔ∏è', npc.x, npc.y);
                ctx.shadowBlur = 0;
            });

            // Collectibles
            game.collectibles.forEach(c => {
                ctx.font = '25px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚≠ê', c.x, c.y);
            });

            // Player
            ctx.fillStyle = '#00C48C';
            ctx.beginPath();
            ctx.arc(game.player.x, game.player.y, game.player.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.stroke();

            // Player emoji
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üßë', game.player.x, game.player.y);

            // Particles
            game.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 30;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }

        // Initial render
        render();
    </script>
</body>
</html>